<%page args="course, enrollment, show_courseware_link, cert_status, show_email_settings, course_mode_info, show_refund_option, is_paid_course, is_course_blocked, verification_status, course_requirements" />

<%!
from django.utils.translation import ugettext as _
from django.utils.translation import ungettext
from django.core.urlresolvers import reverse
from markupsafe import escape
from courseware.courses import course_image_url, get_course_about_section
from student.helpers import (
  VERIFY_STATUS_NEED_TO_VERIFY,
  VERIFY_STATUS_SUBMITTED,
  VERIFY_STATUS_APPROVED,
  VERIFY_STATUS_MISSED_DEADLINE
)
%>

<%
  cert_name_short = course.cert_name_short
  if cert_name_short == "":
    cert_name_short = settings.CERT_NAME_SHORT

  cert_name_long = course.cert_name_long
  if cert_name_long == "":
    cert_name_long = settings.CERT_NAME_LONG
  billing_email = settings.PAYMENT_SUPPORT_EMAIL
%>

<%namespace name='static' file='/static_content.html'/>

<div class="row cmc-dashboard-course">
  % if settings.FEATURES.get('ENABLE_VERIFIED_CERTIFICATES'):
    % if enrollment.mode == "verified":
      % if settings.FEATURES.get('SEPARATE_VERIFICATION_FROM_PAYMENT') and request.session.get('separate-verified', False):
        % if verification_status.get('status') in [VERIFY_STATUS_NEED_TO_VERIFY, VERIFY_STATUS_SUBMITTED, VERIFY_STATUS_APPROVED]:
          <% mode_class = " verified" %>
        % else:
          <% mode_class = " honor" %>
        % endif
      % else:
        <% mode_class = " verified" %>
      % endif
    % else:
      <% mode_class = " " + enrollment.mode %>
    % endif
  % else:
    <% mode_class = "" %>
  % endif

  <%
    course_target = reverse('info', args=[course.id.to_deprecated_string()])
  %>

  % if show_courseware_link:
    % if not is_course_blocked:
      <a href="${course_target}" class="col-xs-12 col-sm-5 col-md-6 cmc-dashboard-course__image">
        <img src="${course_image_url(course)}" alt="${_('{course_number} {course_name} Cover Image').format(course_number=course.number, course_name=course.display_name_with_default) |h}">
        % if settings.FEATURES.get('ENABLE_VERIFIED_CERTIFICATES'):
          % if enrollment.mode == "verified":
            % if settings.FEATURES.get('SEPARATE_VERIFICATION_FROM_PAYMENT') and request.session.get('separate-verified', False):
              % if verification_status.get('status') in [VERIFY_STATUS_NEED_TO_VERIFY, VERIFY_STATUS_SUBMITTED]:
                <div class="course-ribbon verified" title="${_("Your verification is pending")}"><span>ID PENDING</span></div>
              % elif verification_status.get('status') == VERIFY_STATUS_APPROVED:
                <div class="course-ribbon verified" title="${_("You're enrolled as a verified student")}"><span>VERIFIED</span></div>
              % else:
                <div class="course-ribbon verified" title="${_("You're enrolled as an honor code student")}"><span>HONOR CODE</span></div>
              % endif
            % else:
              <div class="course-ribbon verified" title="${_("You're enrolled as a verified student")}"><span>VERIFIED</span></div>
            % endif
          % elif enrollment.mode == "honor":
            <div class="course-ribbon verified" title="${_("You're enrolled as an honor code student")}"><span>HONOR CODE</span></div>
          % elif enrollment.mode == "audit":
            <div class="course-ribbon verified" title="${_("You're auditing this course")}"><span>AUDITING</span></div>
          % elif enrollment.mode == "professional":
            <div class="course-ribbon verified" title="${_("You're enrolled as a professional education student")}"><span>PROFESSIONAL</span></div>
          % endif
        % endif
      </a>
    % else:
      <div class="col-xs-12 col-sm-5 col-md-6 cmc-dashboard-course__image course-blocked">
        <img src="${course_image_url(course)}" alt="${_('{course_number} {course_name} Cover Image').format(course_number=course.number, course_name=course.display_name_with_default) |h}">
        % if settings.FEATURES.get('ENABLE_VERIFIED_CERTIFICATES'):
          % if enrollment.mode == "verified":
            % if settings.FEATURES.get('SEPARATE_VERIFICATION_FROM_PAYMENT') and request.session.get('separate-verified', False):
              % if verification_status.get('status') in [VERIFY_STATUS_NEED_TO_VERIFY, VERIFY_STATUS_SUBMITTED]:
                <div class="course-ribbon verified" title="${_("Your verification is pending")}"><span>ID PENDING</span></div>
              % elif verification_status.get('status') == VERIFY_STATUS_APPROVED:
                <div class="course-ribbon verified" title="${_("You're enrolled as a verified student")}"><span>VERIFIED</span></div>
              % else:
                <div class="course-ribbon verified" title="${_("You're enrolled as an honor code student")}"><span>HONOR CODE</span></div>
              % endif
            % else:
              <div class="course-ribbon verified" title="${_("You're enrolled as a verified student")}"><span>VERIFIED</span></div>
            % endif
          % elif enrollment.mode == "honor":
            <div class="course-ribbon verified" title="${_("You're enrolled as an honor code student")}"><span>HONOR CODE</span></div>
          % elif enrollment.mode == "audit":
            <div class="course-ribbon verified" title="${_("You're auditing this course")}"><span>AUDITING</span></div>
          % elif enrollment.mode == "professional":
            <div class="course-ribbon verified" title="${_("You're enrolled as a professional education student")}"><span>PROFESSIONAL</span></div>
          % endif
        % endif
      </div>
    % endif
  % else:
    <div class="col-xs-12 col-sm-5 col-md-6 cmc-dashboard-course__image">
      <img src="${course_image_url(course)}" alt="${_('{course_number} {course_name} Cover Image').format(course_number=course.number, course_name=course.display_name_with_default) |h}">
      % if settings.FEATURES.get('ENABLE_VERIFIED_CERTIFICATES'):
        % if enrollment.mode == "verified":
          % if settings.FEATURES.get('SEPARATE_VERIFICATION_FROM_PAYMENT') and request.session.get('separate-verified', False):
            % if verification_status.get('status') in [VERIFY_STATUS_NEED_TO_VERIFY, VERIFY_STATUS_SUBMITTED]:
              <div class="course-ribbon verified" title="${_("Your verification is pending")}"><span>ID PENDING</span></div>
            % elif verification_status.get('status') == VERIFY_STATUS_APPROVED:
              <div class="course-ribbon verified" title="${_("You're enrolled as a verified student")}"><span>VERIFIED</span></div>
            % else:
              <div class="course-ribbon verified" title="${_("You're enrolled as an honor code student")}"><span>HONOR CODE</span></div>
            % endif
          % else:
            <div class="course-ribbon verified" title="${_("You're enrolled as a verified student")}"><span>VERIFIED</span></div>
          % endif
        % elif enrollment.mode == "honor":
          <div class="course-ribbon verified" title="${_("You're enrolled as an honor code student")}"><span>HONOR CODE</span></div>
        % elif enrollment.mode == "audit":
          <div class="course-ribbon verified" title="${_("You're auditing this course")}"><span>AUDITING</span></div>
        % elif enrollment.mode == "professional":
          <div class="course-ribbon verified" title="${_("You're enrolled as a professional education student")}"><span>PROFESSIONAL</span></div>
        % endif
      % endif
    </div>
  % endif




  <div class="col-xs-12 col-sm-7 col-md-6 cmc-dashboard-course__info">
    % if show_courseware_link:
      % if not is_course_blocked:
        <a href="${course_target}" class="cmc-dashboard-course__name"><span>${course.display_number_with_default | h}:</span>${get_course_about_section(course, 'title')}</a>
      % else:
        <h3 class="cmc-dashboard-course__name"><span>${course.display_number_with_default | h}:</span>${get_course_about_section(course, 'title')}</h3>
      % endif
    %endif
    <p class="cmc-dashboard-course__description">
      ${get_course_about_section(course, 'short_description')}
    </p>

    % if is_course_blocked:
      <p id="block-course-msg" class="course-block cmc-dashboard-course__description" style="font-style: italic;">
        ${_("You can no longer access this course because payment has not yet been received. "
            "You can {contact_link_start}contact the account holder{contact_link_end} "
            "to request payment, or you can "
            "{unenroll_link_start}unenroll{unenroll_link_end} "
            "from this course").format(
          contact_link_start='<a href="#">',
          contact_link_end='</a>',
          unenroll_link_start=(
            '<a id="unregister_block_course" rel="leanModal" '
            'data-course-id="{course_id}" data-course-number="{course_number}" '
            'href="#unenroll-modal">'.format(
              course_id=escape(course.id),
              course_number=escape(course.number),
            )
          ),
          unenroll_link_end="</a>",
        )}
      </p>
    %endif

    % if course.may_certify() and cert_status:
    <%include file='_dashboard_certificate_information.html' args='cert_status=cert_status,course=course, enrollment=enrollment'/>
    % endif

    % if settings.FEATURES.get('SEPARATE_VERIFICATION_FROM_PAYMENT') and request.session.get('separate-verified', True):
      % if verification_status.get('status') in [VERIFY_STATUS_NEED_TO_VERIFY, VERIFY_STATUS_SUBMITTED, VERIFY_STATUS_APPROVED] and not is_course_blocked:
      <div class="message message-status is-shown cmc-course__description">
        % if verification_status['status'] == VERIFY_STATUS_NEED_TO_VERIFY:
          <div class="verification-reminder">
            % if verification_status['days_until_deadline'] is not None:
              <h4 class="message-title">${_('Verification not yet complete.')}</h4>
              <p class="message-copy">${ungettext(
                'You only have {days} day left to verify for this course.',
                'You only have {days} days left to verify for this course.',
                verification_status['days_until_deadline']
              ).format(days=verification_status['days_until_deadline'])}</p>
            % else:
              <h4 class="message-title">${_('Almost there!')}</h4>
              <p class="message-copy">${_('You still need to verify for this course.')}</p>
            % endif
          </div>
          <div class="verification-cta">
            <a href="${reverse('verify_student_verify_later', kwargs={'course_id': unicode(course.id)})}" class="cta" data-course-id="${course.id | h}">${_('Verify Now')}</a>
          </div>
        % elif verification_status['status'] == VERIFY_STATUS_SUBMITTED:
          <h4 class="message-title">${_('You have already verified your ID!')}</h4>
          <p class="message-copy">${_('Thanks for your patience as we process your request.')}</p>
        % elif verification_status['status'] == VERIFY_STATUS_APPROVED:
          <h4 class="message-title">${_('You have already verified your ID!')}</h4>
          % if verification_status['verification_good_until'] is not None:
            <p class="message-copy">${_('Your verification status is good until {date}.').format(date=verification_status['verification_good_until'])}
          % endif
        % endif
      </div>
      % endif
    % endif

    <h4 class="cmc-dashboard-course__time"><span>Starts:</span>Self-paced</h4>
    <div class="cmc-dashboard-course__options">

      % if show_email_settings:
              % if not is_course_blocked:
              <a href="#email-settings-modal" class="email-settings cmc-dashboard-course__options__email" rel="leanModal" data-course-id="${course.id | h}" data-course-number="${course.number | h}" data-optout="${unicode(course.id) in course_optouts}">${_('Email Settings')}</a>
              % else:
              <a class="disable-look-settings cmc-dashboard-course__options__email" data-course-id="${course.id| h}" data-course-number="${course.number | h}" data-optout="${unicode(course.id) in course_optouts}">${_('Email Settings')}</a>
              % endif
      % endif

      % if is_paid_course and show_refund_option:
        ## Translators: The course's name will be added to the end of this sentence.
        % if not is_course_blocked:
        <a href="#unenroll-modal" class="unenroll cmc-dashboard-course__options__unenroll" rel="leanModal" data-course-id="${course.id | h}" data-course-number="${course.number | h}" onclick="document.getElementById('track-info').innerHTML='${_("Are you sure you want to unenroll from the purchased course")}';
        document.getElementById('refund-info').innerHTML=gettext('You will be refunded the amount you paid.')">
          ${_('Unenroll')}
        </a>
        % else:
        <a class="disable-look-unregister cmc-dashboard-course__options__unenroll" data-course-id="${course.id | h}" data-course-number="${course.number | h}" onclick="document.getElementById('track-info').innerHTML='${_("Are you sure you want to unenroll from the purchased course")}';
        document.getElementById('refund-info').innerHTML=gettext('You will be refunded the amount you paid.')">
          ${_('Unenroll')}
        </a>
        % endif
      % elif is_paid_course and not show_refund_option:
        ## Translators: The course's name will be added to the end of this sentence.
        % if not is_course_blocked:
        <a href="#unenroll-modal" class="unenroll cmc-dashboard-course__options__unenroll" rel="leanModal" data-course-id="${course.id | h}" data-course-number="${course.number | h}" onclick="document.getElementById('track-info').innerHTML='${_("Are you sure you want to unenroll from the purchased course")}';
        document.getElementById('refund-info').innerHTML=gettext('You will not be refunded the amount you paid.')">
          ${_('Unenroll')}
        </a>
        % else:
        <a class="disable-look-unregister cmc-dashboard-course__options__unenroll" data-course-id="${course.id | h}" data-course-number="${course.number | h}" onclick="document.getElementById('track-info').innerHTML='${_("Are you sure you want to unenroll from the purchased course")}';
        document.getElementById('refund-info').innerHTML=gettext('You will not be refunded the amount you paid.')">
          ${_('Unenroll')}
        </a>
        % endif
      % elif enrollment.mode != "verified":
        ## Translators: The course's name will be added to the end of this sentence.
        % if not is_course_blocked:
        <a href="#unenroll-modal" class="unenroll cmc-dashboard-course__options__unenroll" rel="leanModal" data-course-id="${course.id | h}" data-course-number="${course.number | h}" onclick="document.getElementById('track-info').innerHTML='${_("Are you sure you want to unenroll from")}'; document.getElementById('refund-info').innerHTML=''">
          ${_('Unenroll')}
        </a>
        % else:
        <a class="disable-look-unregister cmc-dashboard-course__options__unenroll" data-course-id="${course.id | h}" data-course-number="${course.number | h}" onclick="document.getElementById('track-info').innerHTML='${_("Are you sure you want to unenroll from")}'; document.getElementById('refund-info').innerHTML=''">
          ${_('Unenroll')}
        </a>
        % endif
      % elif show_refund_option:
        ## Translators: The course's name will be added to the end of this sentence.
        % if not is_course_blocked:
        <a href="#unenroll-modal" class="unenroll cmc-dashboard-course__options__unenroll" rel="leanModal" data-course-id="${course.id | h}" data-course-number="${course.number | h}" onclick="document.getElementById('track-info').innerHTML='${_("Are you sure you want to unenroll from the verified {cert_name_long} track of").format(cert_name_long=cert_name_long)}';
        document.getElementById('refund-info').innerHTML=gettext('You will be refunded the amount you paid.')">
          ${_('Unenroll')}
        </a>
        % else:
        <a class="disable-look-unregister cmc-dashboard-course__options__unenroll" data-course-id="${course.id | h}" data-course-number="${course.number | h}" onclick="document.getElementById('track-info').innerHTML='${_("Are you sure you want to unenroll from the verified {cert_name_long} track of").format(cert_name_long=cert_name_long)}';
        document.getElementById('refund-info').innerHTML=gettext('You will be refunded the amount you paid.')">
          ${_('Unenroll')}
        </a>
        % endif
      % else:
        ## Translators: The course's name will be added to the end of this sentence.
        % if not is_course_blocked:
        <a href="#unenroll-modal" class="unenroll cmc-dashboard-course__options__unenroll" rel="leanModal" data-course-id="${course.id | h}" data-course-number="${course.number | h}" onclick="document.getElementById('track-info').innerHTML='${_("Are you sure you want to unenroll from the verified {cert_name_long} track of").format(cert_name_long=cert_name_long)}';
        document.getElementById('refund-info').innerHTML=gettext('The refund deadline for this course has passed, so you will not receive a refund.')">
          ${_('Unenroll')}
        </a>
        % else:
        <a class="disable-look-unregister cmc-dashboard-course__options__unenroll" data-course-id="${course.id | h}" data-course-number="${course.number | h}" onclick="document.getElementById('track-info').innerHTML='${_("Are you sure you want to unenroll from the verified {cert_name_long} track of").format(cert_name_long=cert_name_long)}';
        document.getElementById('refund-info').innerHTML=gettext('The refund deadline for this course has passed, so you will not receive a refund.')">
          ${_('Unenroll')}
        </a>
        % endif
      % endif

    </div>
    <div class="cmc-dashboard-course__description">
      % if course_requirements:
      ## Multiple pre-requisite courses are not supported on frontend that's why we are pulling first element
      <% prc_target = reverse('about_course', args=[unicode(course_requirements['courses'][0]['key'])]) %>
      <section class="prerequisites">
        <p class="tip">
          ${_("You must successfully complete {link_start}{prc_display}{link_end} before you begin this course.").format(
              link_start='<a href="{}">'.format(prc_target),
              link_end='</a>',
              prc_display=course_requirements['courses'][0]['display'],
            )}
        </p>
      </section>
      % endif
    </div>
  </div>
</div>

 <script>
           $( document ).ready(function() {

               if("${is_course_blocked}" == "True"){
                   $( "#unregister_block_course" ).click(function() {
                       $('.disable-look-unregister').click();
                   });
               }
           });
 </script>

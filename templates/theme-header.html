## mako
<%namespace name='static' file='static_content.html'/>
<%namespace file='main.html' import="login_query, stanford_theme_enabled"/>
<%!
from django.core.urlresolvers import reverse
from django.utils.translation import ugettext as _

from microsite_configuration import microsite
from microsite_configuration.templatetags.microsite import platform_name
from ccx.overrides import get_current_ccx

# App that handles subdomain specific branding
import branding
# app that handles site status messages
from status.status import get_site_status_msg
%>

## Provide a hook for themes to inject branding on top.
<%block name="navigation_top" />



<%block>
<%
try:
    course_id = course.id.to_deprecated_string()
except:
    # can't figure out a better way to get at a possibly-defined course var
    course_id = None
site_status_msg = get_site_status_msg(course_id)
%>
% if site_status_msg:
<div class="site-status">
  <div class="inner-wrapper">
    <span class="white-error-icon"></span>
    <p>${site_status_msg}</p>
  </div>
</div>
% endif
</%block>

% if settings.FEATURES.get('ENABLE_NUKE_CACHE'):
    % if user.is_superuser:
      <!-- Nuke cache modal -->
      <div class="modal fade" id="nukeCacheModal" class="nukeCache" tabindex="-1" role="dialog" aria-labelledby="nukeCache">
        <div class="nukeCache__wrapper">
          <div class="nukeCache__container container">
            <h1>Nuke the edX template cache</h1>
            <p>The button below will clear all edX template caches. Use it in case you've made changes to templates, but they aren't showing up and you're now really getting pissed off and frustrated.</p>
            <form action="${reverse('nuke_cache')}" method="post">
              <input type="hidden" name="csrfmiddlewaretoken" value="${ csrf_token }">
              <button type="submit" class="nukeCache__button"><img src="${static.url('themes/' + settings.FEATURES.get('THEME_FOLDER') + '/images/radiation.svg')}"></button>
            </form>
            <a href="#" class="nukeCache__cancel" data-dismiss="modal" aria-label="Cancel">NO! I cannot do this! Oh the humanity!</a>
            <img class="nukeCache__falloutGuy" src="${static.url('themes/' + settings.FEATURES.get('THEME_FOLDER') + '/images/fallout-guy-png.png')}">
          </div>
        </div>
      </div>
    % endif
% endif


<nav class="navbar navbar-default" id="navbar">
  <div class="navigation container-bs">
    <div class="navbar-header">
      <a class="page-scroll navbar__logo navbar__logo__positive" href="${marketing_link('ROOT')}"><img src="${static.url('themes/' + settings.FEATURES.get('THEME_FOLDER') + '/images/brand-logo.svg')}" alt="${platform_name()}"></a>
      <a class="page-scroll navbar__logo navbar__logo__negative" href="${marketing_link('ROOT')}"><img src="${static.url('themes/' + settings.FEATURES.get('THEME_FOLDER') + '/images/brand-logo-negative.svg')}" alt="${platform_name()}"></a>

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#edx-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
      </button>

      ## If on a course page - display course info
      % if course:
        <div class="navigation__course-name"><span class="navigation__course-name__provider">${course.display_org_with_default | h}:</span> ${course.display_number_with_default | h} ${course.display_name_with_default}</div>
      % endif
    </div>

    <div class="collapse navbar-collapse" id="edx-navbar-collapse">
      <ul class="nav navbar-nav">

        % if user.is_authenticated():

          ## If courses are browsable display these items
          % if settings.FEATURES.get('COURSES_ARE_BROWSABLE'):
            <ul class="navigation-group navigation-group__links-authenticated">
              <li><a href="${marketing_link('COURSES')}">Find Courses</a></li>
            </ul>
          % endif

          ## Display user section of menu
          <ul class="navigation-group navigation-group__user">
            <li>
            <span class="navigation-group__user__avatar avatar"><i class="fa fa-user"></i></span><a href="#" class="navigation-group__user__name-toggle dropdown-toggle" id="userDropdownMenu" data-toggle="dropdown" aria-expanded="true">${user.username} <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu" role="menu" aria-labelledby="userDropdownMenu">
                <li><a href="${reverse('dashboard')}">Dashboard</a></li>
                <li class="divider"></li>
                <li><a href="${reverse('learner_profile', kwargs={'username': user.username})}">My Profile</a></li>
                <li><a href="${reverse('account_settings')}">Account Settings</a></li>
                % if settings.FEATURES.get('ENABLE_NUKE_CACHE'):
                    %if user.is_superuser:
                      <li class="divider"></li>
                      <li><a href="#" data-toggle="modal" data-target="#nukeCacheModal">Nuke cache</a></li>
                    %endif
                %endif
                % if settings.FEATURES.get('ENABLE_SYSADMIN_DASHBOARD'):
                    %if user.is_superuser:
                      <li class="divider"></li>
                      <li><a href="/sysadmin">SysAdmin Dashboard</a></li>
                    %endif
                %endif
                <li class="divider"></li>
                <li><a href="${reverse('logout')}">Log Out</a></li>
              </ul>
            </li>
            % if display_shopping_cart:
              <li class="navigation-group__user__cart"><a href="${reverse('shoppingcart.views.show_cart')}"><i class="fa fa-shopping-cart"></i></a></li>
            % endif
          </ul>

        ## Elements to display to non authenticated users
        % else:
          % if settings.FEATURES.get('COURSES_ARE_BROWSABLE'):
            <ul class="navigation-group navigation-group__links-authenticated">
              <li><a href="${marketing_link('COURSES')}">Find Courses</a></li>
            </ul>
          % endif

          ## Optional sales links
          % if microsite.get_value('ENABLE_MKTG_SITE', settings.FEATURES.get('ENABLE_MKTG_SITE', False)):
            <ul style="display: none" class="navigation-group navigation-group__global-links">
              <li><a href="${marketing_link('HOW_IT_WORKS')}">How it Works</a></li>
              <li><a href="${marketing_link('SCHOOLS')}">Schools & Partners</a></li>
            </ul>
          % endif

          ## Login/signup section
          <ul class="navigation-group navigation-group__login">

            % if not settings.FEATURES['DISABLE_LOGIN_BUTTON']:
              % if course and settings.FEATURES.get('RESTRICT_ENROLL_BY_REG_METHOD') and course.enrollment_domain:
                <li><a class="cta-login" href="${reverse('course-specific-login', args=[course.id.to_deprecated_string()])}${login_query()}">Sign in</a></li>
              % else:
                <li><a class="cta-login" href="/login${login_query()}">Sign in</a></li>
              % endif
            % endif

            % if not settings.FEATURES['DISABLE_LOGIN_BUTTON']:
              % if course and settings.FEATURES.get('RESTRICT_ENROLL_BY_REG_METHOD') and course.enrollment_domain:
                <li><a class="cta-register navbar__button" href="${reverse('course-specific-register', args=[course.id.to_deprecated_string()])}">Register now!</a></li>
              % else:
                <li><a class="cta-register navbar__button" href="/register">Register now!</a></li>
              % endif
            % endif
          </ul>
        % endif
      </ul>
    </div>
  </div>
</nav>

  ## Display IE8 warning banner
  % if course:
    <!--[if lte IE 9]>
    <div class="ie-banner" aria-hidden="true">${_('<strong>Warning:</strong> Your browser is not fully supported. We strongly recommend using {chrome_link} or {ff_link}.').format(chrome_link='<a href="https://www.google.com/chrome" target="_blank">Chrome</a>', ff_link='<a href="http://www.mozilla.org/firefox" target="_blank">Firefox</a>')}</div>
    <![endif]-->
  % endif

<%include file="help_modal.html"/>
